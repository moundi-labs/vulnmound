.PHONY: all build test-vulnerable test-mitigation test-poc clean help

# Docker image name
IMAGE_NAME = cve-2025-9566-poc

all: build test-poc

build:
	@echo "Building Docker image..."
	@echo "========================"
	@docker build -t $(IMAGE_NAME) .

test-vulnerable:
	@echo "Testing vulnerable version in Docker..."
	@echo "======================================"
	@docker run --rm $(IMAGE_NAME) go run vulnerable.go

test-mitigation:
	@echo ""
	@echo "Testing secure version (mitigation) in Docker..."
	@echo "==============================================="
	@docker run --rm $(IMAGE_NAME) go run mitigation.go

test-poc:
	@echo ""
	@echo "Testing PoC (Proof of Concept) in Docker..."
	@echo "==========================================="
	@docker run --rm $(IMAGE_NAME)

test-all: test-vulnerable test-mitigation test-poc

clean:
	@echo "Cleaning up Docker resources..."
	@echo "=============================="
	@docker rmi $(IMAGE_NAME) 2>/dev/null || true
	@echo "Docker image removed"

clean-all: clean
	@echo "Cleaning up all Docker containers and images..."
	@docker system prune -f

help:
	@echo "Available targets:"
	@echo "  build           - Build Docker image"
	@echo "  test-vulnerable - Run vulnerable version in Docker"
	@echo "  test-mitigation - Run secure version in Docker"
	@echo "  test-poc        - Run proof of concept attack in Docker"
	@echo "  test-all        - Run all tests in Docker"
	@echo "  clean           - Remove Docker image"
	@echo "  clean-all       - Clean up all Docker resources"
	@echo "  all             - Build and run PoC"
